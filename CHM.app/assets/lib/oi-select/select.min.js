angular.module("oi.select",[]);angular.module("oi.select").provider("oiSelect",function(){return{options:{debounce:500,searchFilter:"oiSelectCloseIcon",dropdownFilter:"oiSelectHighlight",listFilter:"oiSelectAscSort",saveLastQuery:null,newItem:!1,saveTrigger:"enter, backslash"},$get:function(){return{options:this.options}}}}).factory("oiUtils",["$document",function(n){function r(t,i){var r=angular.element("<mirror>").css({position:"absolute",width:"auto",padding:0,whiteSpace:"pre",visibility:"hidden","z-index":-99999}).text(t||""),f;return u(i,r,"letterSpacing fontSize fontFamily fontWeight textTransform".split(" ")),n[0].body.appendChild(r[0]),f=r[0].offsetWidth,r.remove(),f}function u(n,t,i){for(var u={},f=getComputedStyle(n[0],""),r=0,e=i.length;r<e;r++)u[i[r]]=f[i[r]];t.css(u)}function f(n,r){var u,e,o,f,s,h;r&&(e=n.offsetHeight,o=i(r,"height","margin"),f=n.scrollTop||0,u=t(r).top-t(n).top+f,s=u,h=u-e+o,u+o>e+f?n.scrollTop=h:u<f&&(n.scrollTop=s))}function s(n,t,i,r,u){function s(n){return parseFloat(u[n])}for(var f=i===(r?"border":"content")?4:t==="width"?1:0,e=0,o=["Top","Right","Bottom","Left"];f<4;f+=2)i==="margin"&&(e+=s(i+o[f])),r?(i==="content"&&(e-=s("padding"+o[f])),i!=="margin"&&(e-=s("border"+o[f]+"Width"))):(e+=s("padding"+o[f]),i!=="padding"&&(e+=s("border"+o[f]+"Width")));return e}function t(n){var t,i,u=n.getBoundingClientRect(),r=n&&n.ownerDocument;if(r)return t=r.documentElement,i=h(r),{top:u.top+i.pageYOffset-t.clientTop,left:u.left+i.pageXOffset-t.clientLeft}}function h(n){return n!=null&&n===n.window?n:n.nodeType===9&&n.defaultView}function i(n,t,i){var r=t==="width"?n.offsetWidth:n.offsetHeight,u=window.getComputedStyle(n,null);if(r<=0||r==null){if(r=u[t],(r<0||r==null)&&(r=n.style[t]),o.test(r))return r;r=parseFloat(r)||0}return r+s(n,t,i||"content",!0,u)}function c(n,t){t.css("width",i(n[0],"width","margin")+"px")}function l(n){for(var t in n)if(n.hasOwnProperty(t)&&n[t].length)return!1;return!0}function a(n){var t=[];return angular.forEach(n,function(n,i){i.toString().charAt(0)!=="$"&&t.push(n)}),t}function v(n,t){if(n===t)return!0;if(!(n instanceof Object)||!(t instanceof Object)||n.constructor!==t.constructor)return!1;for(var i in n)if(n.hasOwnProperty(i)){if(!t.hasOwnProperty(i))return!1;if(n[i]!==t[i]&&(typeof n[i]!="object"||!objectEquals(n[i],t[i])))return!1}for(i in t)if(t.hasOwnProperty(i)&&!n.hasOwnProperty(i))return!1;return!0}function y(n,t,i,r,u,f){var e,o,h,c,l,s=f?[].concat(n):[];for(i=i||function(n,t){return n===t},e=0,h=n.length;e<n.length;e++)for(c=r?r(n[e]):n[e],o=0;o<t.length;o++)if(l=u?u(t[o]):t[o],i(c,l,n,t,e,o)){f?s.splice(e+s.length-h,1):s.push(n[e]);break}return s}function p(n,t,i,r){var u={};return n.split(".").reduce(function(n,i,r,u){return n[i]=r<u.length-1?{}:t},u),r(i,u)}var e=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,o=new RegExp("^("+e+")(?!px)[a-z%]+$","i");return{copyWidth:c,measureString:r,scrollActiveOption:f,groupsIsEmpty:l,objToArr:a,getValue:p,isEqual:v,intersection:y}}]);angular.module("oi.select").directive("oiSelect",["$document","$q","$timeout","$parse","$interpolate","$injector","$filter","oiUtils","oiSelect",function(n,t,i,r,u,f,e,o,s){var h=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,c=/([^\(\)\s\|\s]*)\s*(\(.*\))?\s*(\|?\s*.+)?/;return{restrict:"AE",templateUrl:"app_dev/js/templates/oi-select/template.html",require:"ngModel",scope:{},compile:function(l,a){var et=a.oiOptions,v;if(!(v=et.match(h)))throw new Error("Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_'");var tt=/ as /.test(v[0])&&v[1],it=v[2]||v[1],p=v[5]||v[7],ot=v[3]||"",st=v[4]||"",ht=v[9]||it,k=v[8].match(c),d=k[1],ct=d+(k[3]||""),lt=d+(k[2]||""),g=tt&&r(tt),at=r(it),vt=r(ot),yt=r(st),pt=r(ct),wt=r(lt),bt=r(ht),w=angular.isDefined(a.multiple),rt=Number(a.multipleLimit),kt=u(a.placeholder||""),b=!1,nt=!1,ut=r(a.oiSelectOptions),y,ft;return function(r,u,h,c){function st(n){var o=new RegExp(n).test(l.saveTrigger),s=l.newItem&&r.query,u=angular.isNumber(r.selectorPosition),f=r.order[r.selectorPosition],h=l.newItemFn||l.newItemModelFn,e=t.reject();o&&(s||u&&f)&&(r.showLoader=!0,e=t.when(n!=="blur"&&f||r.query&&h(r.query)));e.then(r.addItem).finally(function(){var n=r.order.length-1;r.selectorPosition===n&&ot(v,0);l.newItemFn&&!u||i(angular.noop);tt()})}function ht(t){t&&t.target.ownerDocument.activeElement===a[0]||(i(function(){u.triggerHandler("blur")}),st("blur"),n.off("click",ht),r.isFocused=!1,r.$evalAsync())}function it(){var n=c.$modelValue&&c.$modelValue.length?"":ni;a.attr("placeholder",n);r.inputWidth=o.measureString(r.query||n,a)+4}function et(n){return o.getValue(p,n,r.$parent,bt)}function lt(n){return o.getValue(p,n,r.$parent,g)}function ct(n){return o.getValue(p,n,r.$parent,at)}function ii(n){return o.getValue(p,n,r.$parent,yt)}function dt(n){return o.getValue(p,n,r.$parent,vt)||""}function ri(n){return o.getValue(d,n,r.$parent,pt)}function k(n,u){var f=wt(r.$parent,{$query:n,$querySelectAs:u}),s=0;return r.selectorPosition=l.newItem==="prompt"?!1:0,n||u||(r.oldQuery=null),y&&(angular.isFunction(f.then)||angular.isFunction(f.$promise))&&(i.cancel(y),s=l.debounce),y=i(function(){return r.showLoader=!0,t.when(f.$promise||f).then(function(t){if(!u){var i=e(l.listFilter)(o.objToArr(t),n,ct),f=o.intersection(i,r.output,o.isEqual,et,et,!0),s=ri(f);r.groups=ui(s);gt()}return t}).finally(function(){r.showLoader=!1})},s)}function gt(){var t,n,u,i=[],f=0;r.order=[];r.groupPos={};for(n in r.groups)r.groups.hasOwnProperty(n)&&n.charAt(0)!="$"&&i.push(n);for(angular.version.major<=1&&angular.version.minor<=3&&i.sort(),t=0;t<i.length;t++)n=i[t],u=r.groups[n],r.order=r.order.concat(u),r.groupPos[n]=f,f+=u.length}function tt(){r.oldQuery=null;r.backspaceFocus=!1;r.query="";r.groups={};r.order=[];r.showLoader=!1;r.isOpen=!1;y&&i.cancel(y)}function ot(n,t){r.selectorPosition=t;o.scrollActiveOption(n[0],n.find("li")[t])}function ui(n){for(var i={"":[]},r,u,t=0;t<n.length;t++)r=dt(n[t]),(u=i[r])||(u=i[r]=[]),u.push(n[t]);return i}var a=u.find("input"),v=angular.element(u[0].querySelector(".select-dropdown")),ni=kt(r),l=angular.extend({},s.options,ut(r.$parent)),ti=l.saveLastQuery?f.get(l.saveLastQuery):function(){return""};l.newItemModelFn=function(n){return(ut({$query:n})||{}).newItemModel||n};angular.isDefined(h.autofocus)&&i(function(){a[0].focus()});angular.isDefined(h.readonly)&&a.attr("readonly",!0);h.$observe("disabled",function(n){a.prop("disabled",n)});r.$parent.$watch(h.ngModel,function(n){it();var i=n instanceof Array?n:n?[n]:[],u=t.when(i);g&&n&&(u=k(null,n).then(function(n){return o.intersection(n,i,o.isEqual,lt)}),y=null);u.then(function(n){r.output=n;n.length!==i.length&&r.removeItem(n.length)})});r.$watch("query",function(n,t){it();n===t||r.oldQuery&&!n||nt||(v[0].scrollTop=0,n?(k(n),r.oldQuery=null):(tt(),nt=!0));nt=!1});r.$watch("groups",function(n){o.groupsIsEmpty(n)?r.isOpen=!1:r.isOpen||h.disabled||(r.isOpen=!0,r.isFocused=!0,o.copyWidth(u,v))});r.$watch("isFocused",function(t){if(t){u.triggerHandler("focus");n.on("click",ht)}});r.setFocus=function(n){if(!h.disabled){if(r.backspaceFocus=!1,n.target.nodeName!=="INPUT"&&a[0].focus(),n.type==="focus"&&!r.isOpen&&!r.isFocused){r.isFocused=!0;return}n.type==="click"&&angular.element(n.target).scope()===this&&(r.isOpen&&!r.query?tt():k(r.query))}};r.addItem=function(n){if((ft=r.query,!o.intersection(r.output,[n],null,et,et).length)&&(isNaN(rt)||!(r.output.length>=rt))){var i=r.groups[dt(n)],t=g?lt(n):n;i.splice(i.indexOf(n),1);w?(c.$setViewValue(angular.isArray(c.$modelValue)?c.$modelValue.concat(t):[t]),gt()):(c.$setViewValue(t),tt());o.groupsIsEmpty(r.groups)&&(r.groups={});r.oldQuery=r.oldQuery||r.query;r.query="";r.backspaceFocus=!1;it()}};r.removeItem=function(n){var t;h.disabled||(w&&n>=0?(t=c.$modelValue[n],c.$modelValue.splice(n,1),c.$setViewValue([].concat(c.$modelValue))):angular.isDefined(h.notempty)||(t=c.$modelValue,c.$setViewValue(undefined)),r.query=ti(t,ft),(r.isOpen||r.oldQuery||!w)&&k(r.oldQuery),it())};r.setSelection=function(n){b||r.selectorPosition===n?b=!1:ot(v,n)};r.keyParser=function(n){var t=0,i=r.order.length-1;switch(n.keyCode){case 38:r.selectorPosition=angular.isNumber(r.selectorPosition)?r.selectorPosition:t;ot(v,r.selectorPosition===t?i:r.selectorPosition-1);b=!0;break;case 40:r.selectorPosition=angular.isNumber(r.selectorPosition)?r.selectorPosition:t-1;ot(v,r.selectorPosition===i?t:r.selectorPosition+1);b=!0;r.query.length||r.isOpen||k();break;case 37:case 39:break;case 13:st("enter");n.preventDefault();break;case 9:ht();break;case 220:st("backslash");n.preventDefault();break;case 27:tt();break;case 8:if(!r.query.length){if(r.backspaceFocus&&r.output&&(r.removeItem(r.output.length-1),!r.output.length)){k();break}r.backspaceFocus=!r.backspaceFocus;break}default:return r.backspaceFocus=!1,!1}};r.getSearchLabel=function(n){var t=ct(n);return l.searchFilter&&(t=e(l.searchFilter)(t,r.oldQuery||r.query,n)),t};r.getDropdownLabel=function(n){var t=ct(n);return l.dropdownFilter&&(t=e(l.dropdownFilter)(t,r.oldQuery||r.query,n)),t};r.getDisableWhen=ii;w&&(c.$isEmpty=function(n){return!n||!n.length});tt()}}}}]);angular.module("oi.select").filter("oiSelectCloseIcon",["$sce",function(n){return function(t){return n.trustAsHtml(t+'<span class="close select-search-list-item_selection-remove">×<\/span>')}}]).filter("oiSelectHighlight",["$sce",function(n){return function(t,i){var r;return i.length>0||angular.isNumber(i)?(t=t.toString(),i=i.toString(),r=t.replace(new RegExp(i,"gi"),"<strong>$&<\/strong>")):r=t,n.trustAsHtml(r)}}]).filter("oiSelectAscSort",function(){function n(n,t,i){var r,f,u=[],e=[],o=[];if(t){for(r=0;r<n.length;r++)i(n[r]).match(new RegExp(t,"i"))&&u.push(n[r]);for(r=0;r<u.length;r++)i(u[r]).match(new RegExp("^"+t,"i"))?e.push(u[r]):o.push(u[r]);f=e.concat(o)}else f=[].concat(n);return f}return n});
//# sourceMappingURL=select.min.js.map
